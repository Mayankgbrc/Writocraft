{% include "navbar.html" %}
{% load static from staticfiles %}
<script>
        $(document).ready(function(){
            $.ajax({
                type: 'POST',
                url: '/commentload/',
                async: false,
                data: {
                    blogid: '{{blogid}}',
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(result){
                    var output = result['status'];
                    if (output == 200){
                        comments = result['data'];
                        for(var i = 0; i < comments.length; i+=1){
                            $("#comments").append("<div><div class='row' style='height: auto; letter-spacing: 0.055em; margin-bottom: 10px;'><div class='col s2' style=' vertical-align: middle;'><img class='circle responsive-img'  src='/static/images/thumbnail/"+comments[i]['user']+".jpg' style='margin-left: auto; margin-right: auto; display: block; width: 60%;' /></div><div id='comm"+comments[i]['id']+"' class='col s10' style='font-size: 20px;'><div style='font-size: 20px'><b>"+comments[i]['user']+"</b></div><div style='font-size: 24px'>"+comments[i]['comment']+"</div><div style='font-size: 14px; font-weight: 400;'>"+comments[i]['date']
                                                    +" | <span onClick='commentClick("+comments[i]['id']+")' for='"+comments[i]['id']+"' style='cursor: pointer; ' class='commentreply' id='"+comments[i]['id']+"'>Reply</span><div id='cmtbox"+comments[i]['id']+"' style='display: none;'><textarea rows='4' cols='70' id='commentbox"+comments[i]['id']+"' style='resize: none;'></textarea><button class='commentcheck  btn waves-effect waves-light' for='"+comments[i]['id']+"' style='margin-top: 5px; background-color: black;' >Reply <i class='fa fa-arrow-right' style='font-size: 1.1rem;'></i></button></div></div></div></div><div id='threadbox"+comments[i]['id']+"'></div>");
                            for(var j = 0; j < comments[i]['commentthread'].length; j+=1){
                                $("#threadbox"+comments[i]['id']).append("<div class='row' style='padding: 1%; margin-left: 15%; border-radius: 10px; box-shadow: 0px 0px 5px #bbb; background-color: #eee; height: auto; letter-spacing: 0.055em; margin-bottom: 10px;'><div class='col s2' style=' vertical-align: middle;'><img class='circle responsive-img'  src='/static/images/thumbnail/"+comments[i]['commentthread'][j]['user']+".jpg' style='margin-left: auto; margin-right: auto; display: block; width: 80%;' /></div><div class='col s10'><div style='font-size: 20px'><b>"
                                                        +comments[i]['commentthread'][j]['user']+"</b></div><div style='font-size: 24px'>"
                                                        +comments[i]['commentthread'][j]['thread']+"</div><div style='font-size: 14px; font-weight: 400;'>"
                                                        +comments[i]['commentthread'][j]['date']+"</div></div></div>");
                            }
                            $("#comments").append("</div><br>");
                        }
                    }
                    else{
                        console.log(output);
                    }
                }
            });

            $.ajax({
                type: 'POST',
                url: '/likescheck/',
                async: false,
                data: {
                    blogid: '{{blogid}}',
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(result){
                    var output = result['status'];
                    if (output == 200){
                        if (result['value'] == 1){
                            $("#heart").attr('class', 'fa fa-heart');
                            $("#heart").attr('style', 'color: #f00');
                            $("#likes").attr('to',1);
                        }
                        else{
                            $("#heart").attr('class', 'fa fa-heart-o');
                            $("#heart").attr('style', 'color: #000');
                            $("#likes").attr('to',0);
                        }
                    }
                    else{
                        console.log(output);
                    }
                }
            })
       
        });

</script>
<style>

    .popover__title {
    font-size: 24px;
    line-height: 36px;
    text-decoration: none;
    color: rgb(228, 68, 68);
    text-align: center;
    padding: 15px 0;
    }

    .popover__wrapper {
    position: relative;
    display: inline-block;
    }
    .popover__content {
    opacity: 0;
    visibility: hidden;
    position: absolute;
    left: -150px;
    transform: translate(0, 10px);
    background-color: #fefefe;
    padding: 0.7rem;
    box-shadow: 0 2px 15px 0 rgba(0, 0, 0, 0.26);
    width: 400px;
    }
    .popover__content:before {
    position: absolute;
    z-index: -1;
    content: "";
    right: calc(50% - 10px);
    top: -8px;
    border-style: solid;
    border-width: 0 10px 10px 10px;
    border-color: transparent transparent #bfbfbf transparent;
    transition-duration: 0.3s;
    transition-property: transform;
    }
    .popover__wrapper:hover .popover__content {
    z-index: 10;
    opacity: 1;
    visibility: visible;
    transform: translate(0, -20px);
    transition: all 0.5s cubic-bezier(0.75, -0.02, 0.2, 0.97);
    }
    .popover__message {
    text-align: center;
    }


.bgfader { 
    -webkit-animation-name: example; /* Safari 4.0 - 8.0 */
    -webkit-animation-duration: 4s; /* Safari 4.0 - 8.0 */
    animation-name: example;
    animation-duration: 4s;
}
/* Safari 4.0 - 8.0 */
@-webkit-keyframes example {
  from {background-color: #888;}
  to {background-color: #eee;}
}

/* Standard syntax */
@keyframes example {
  from {background-color: #888;}
  to {background-color: #eee;}
}
</style>
        <div class="parallax-container">
            <div class="parallax"><img src="/static/images/parallax1.jpg"></div>
        </div>
        <nav>
            <div class="nav-wrapper black flow-text">
                <div class="col s12">
                    <a href="/" class="breadcrumb" style="padding-left: 1%;"><b>Home</b></a>
                    {% if fullname %}
                        <a href="/@{{ username|urlencode }}/" class="breadcrumb"><b>{{ fullname }}</b></a>
                    {% else %}
                        <a href="#" class="breadcrumb"><b>Anonymous</b></a>
                    {% endif %}
                    <a href="/@{{ username|urlencode }}/{{ url|urlencode }}/" class="breadcrumb"><b>{{ heading }}</b></a>
                </div>
            </div>
        </nav>
        <div id="doc">
            <div class="row">
                <div class="col s12 m2 l2  valign-wrapper center-align" style="min-height: 100vh;"><p>Ads</p></div>
                <div class="col s12 m8 l8" style="padding: 5vh 5vw;">
                    <div>
                        <h1>{{heading}}</h1>
                        <div style="font-size: 22px; letter-spacing: 0.0625em; ">{{data|safe}}</div>
                        Total Views - {{ blog_views }}
                        {% if fullname %}
                            <div><b>Written By - </b>
                                <span style="font-family: 'Times New Roman', Times, serif;">
                                    <div class="popover__wrapper">
                                        <a href="/@{{ username|urlencode }}/">
                                            <h2 class="popover__title">{{ fullname }}</h2>
                                        </a>
                                        <div class="popover__content">
                                            <div class="row" style="display: flex; align-items : center;">
                                                <div class="col s5" style="height: 100%; vertical-align: middle;">
                                                    <img alt="Joseph Francis Joey Tribbiani, Jr." style="width: 100%;" src="/static/images/thumbnail/{{ username }}.jpg">
                                                </div>
                                                <div class="col s7">
                                                    {{ fullname }}<br><span style="font-size: 19px;">Total Blogs: {{ numberblog }}</span><br>
                                                    <a href="/@{{ username|urlencode }}/">
                                                        <button class='btn waves-effect waves-light' style="background-color: black; margin-top: 5px;" > View Profile <i class="fa fa-address-book" style="font-size: 1.1rem;"></i></button><br>
                                                    </a>
                                                    <span style="font-size: 16px;">Total post views: {{ user_views }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                            </div>
                        {% else %}
                            <div><b> Written By - Anonymous </b></div>
                        {% endif %}

                    </div>
                    <br>
                    <span id="likes" style="cursor: pointer;"  to="0"><i id="heart" class="fa fa-heart-o" style="color: black;" aria-hidden="true"></i></span>
                    <span id="maincomment" style="cursor: pointer; color: black;" to='0'><i id="icomment" class="fa fa-comment-o" style="color: black;" aria-hidden="true"></i></span>
                    <br><br>
                    <div id='cmtmainbox' style='display: none;'>
                        <textarea id='commentboxmain' for="main" style='resize: none;' rows="4" cols="70"></textarea><br>
                        <button for="main" class='commentcheck btn waves-effect waves-light' style="margin-top: 5px; background-color: black;" >Reply <i class="fa fa-arrow-right" style="font-size: 1.1rem;"></i></button>
                    </div>
                    <div>
                        <div id="comments" style="width: 100%; line-height: 1.3;">
                            
                        </div>
                    </div>
                </div>
                <div class="col s12 m2 l2  valign-wrapper center-align" style="min-height: 100vh;"><p>Ads</p></div>
            </div>            
        </div>
        {% csrf_token %}
        <div class="sharethis-inline-share-buttons"></div>
        
    </body>

    <script>
        $("#likes").click(function(){
            var value = $(this).attr('to');
            if (value == 0){
                $("#heart").attr('class', 'fa fa-heart');
                $("#heart").attr('style', 'color: #f00');
                $(this).attr('to',1);
            }
            else{
                $("#heart").attr('class', 'fa fa-heart-o');
                $("#heart").attr('style', 'color: #000');
                $(this).attr('to',0);
            }
            $.ajax({
                type: 'POST',
                url: '/likes/',
                data: {
                    blogid: '{{blogid}}',
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(result){
                    var output = result['status'];
                    console.log(output);
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(elems, options);
        });

        // Or with jQuery
        $(document).ready(function(){
            $('.sidenav').sidenav();
        });


        $("#icomment").on('click', function(){
            var value = $("#maincomment").attr('to');
            if (value == 0){
                $("#icomment").attr('class', 'fa fa-comment');
                $("#icomment").attr('style', 'color: #D68910; -webkit-text-stroke-width: 1px; -webkit-text-stroke-color: #000;');
                $("#cmtmainbox").slideDown(100);
                $("#maincomment").attr('to',"1");
            }
            else{
                $("#icomment").attr('class', 'fa fa-comment-o');
                $("#icomment").attr('style', 'color: #000;');
                $("#cmtmainbox").slideUp(100);
                $("#maincomment").attr('to','0');
            }
            
        });

        
        function commentClick(x) {
            $("#cmtbox"+x).slideToggle(100);
        }

        function commentThreadClick(x,y) {
            $("#cmtthread"+x+"_"+y).slideToggle(100);
        }


            $(document).on('click', '.commentcheck', function(){
                var value = $(this).attr('for');
                var text = $("#commentbox"+value).val();
                $.ajax({
                    type: 'POST',
                    url: '/commentpush/',
                    async: false,
                    data: {
                        blogid: '{{blogid}}',
                        commentid: value,
                        commenttext: text,
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success: function(result){
                        if (result['status']==200){
                            if (value == "main"){
                                $("#comments").prepend("<div><div class='row bgfader' id='homebt' style='height: auto; letter-spacing: 0.055em; margin-bottom: 10px; border-radius: 10px;'><div class='col s2' style=' vertical-align: middle;'><img class='circle responsive-img'  src='/static/images/thumbnail/"+result['user']+".jpg' style='margin-left: auto; margin-right: auto; display: block; width: 60%;' /></div><div id='comm"+result['id']+"' class='col s10' style='font-size: 20px;'><div style='font-size: 20px'><b>"+result['user']+"</b></div><div style='font-size: 24px'>"+result['comment']+"</div><div style='font-size: 14px; font-weight: 400;'>"+result['date']
                                                    +" | <span onClick='commentClick("+result['id']+")' for='"+result['id']+"' class='commentreply' style = 'cursor: pointer;' id='"+result['id']+"'>Reply</span><div id='cmtbox"+result['id']+"' style='display: none;'><textarea rows='4' cols='70' id='commentbox"+result['id']+"' style='resize: none;'></textarea><button class='commentcheck btn waves-effect waves-light' style='margin-top: 5px; background-color: black;' for='"+result['id']+"' >Reply <i class='fa fa-arrow-right' style='font-size: 1.1rem;'></i></button></div></div></div></div><div id='threadbox"+result['id']+"'></div>");
                                $("#comments").append("</div><br>");
                                $("#commentbox"+value).val('');
                                $("#icomment").attr('class', 'fa fa-comment-o');
                                $("#icomment").attr('style', 'color: #000;');
                                $("#cmtmainbox").slideToggle(50);
                            }
                            else{
                                $("#threadbox"+result['commentid']).prepend("<div id='newbox' class='row bgfader' style='padding: 1%; margin-left: 15%; border-radius: 10px; box-shadow: 0px 0px 5px #bbb; background-color: #eee; height: auto; letter-spacing: 0.055em; margin-bottom: 10px;'><div class='col s2' style=' vertical-align: middle;'><img class='circle responsive-img'  src='/static/images/thumbnail/"+result['user']+".jpg' style='margin-left: auto; margin-right: auto; display: block; width: 80%;' /></div><div class='col s10'><div style='font-size: 20px'><b>"
                                                        +result['user']+"</b></div><div style='font-size: 24px;'>"
                                                        +result['commentthread']+"</div><div style='font-size: 14px;  font-weight: 400;'>"
                                                        +result['date']+"</div></div></div>");
                                $("#commentbox"+value).val('');
                                $("#cmtbox"+value).slideToggle(50);
                                
                            }
                        }
                    }
                });
            });     



    </script>
</html>